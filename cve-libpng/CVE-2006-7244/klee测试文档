在klee测试中,对数据的长度进行了符号化，采用的方法是先符号化整个数据，然后在把除长度以外的数据copy过去，如下代码，profile的前4个字节为长度。
char tempbuff[profile_len];
	memcpy(tempbuff,profile,profile_len);
   klee_make_symbolic(profile,profile_len,"profile");
   memcpy(profile+4,tempbuff+4,profile_len-4);
测试结果：
ht@ht-K55DR:~/libpng/分析报告/CVE-2006-7244/libpng-1.2.14$ klee --libc=uclibc pngtest.bc.bc
KLEE: NOTE: Using klee-uclibc : /home/ht/klee/klee/Release+Asserts/lib/klee-uclibc.bca
KLEE: output directory is "/home/ht/libpng/分析报告/CVE-2006-7244/libpng-1.2.14/klee-out-8"
WARNING: this target does not support the llvm.stacksave intrinsic.
KLEE: WARNING: undefined reference to function: __syscall_rt_sigaction
KLEE: WARNING: undefined reference to function: _setjmp
KLEE: WARNING: undefined reference to function: close
KLEE: WARNING: undefined reference to function: fabs
KLEE: WARNING: undefined reference to function: fcntl
KLEE: WARNING: undefined reference to function: fstat
KLEE: WARNING: undefined reference to function: ioctl
KLEE: WARNING: undefined reference to function: lseek
KLEE: WARNING: undefined reference to function: lseek64
KLEE: WARNING: undefined reference to function: open
KLEE: WARNING: undefined reference to function: png_combine_row
KLEE: WARNING: undefined reference to function: png_do_read_interlace
KLEE: WARNING: undefined reference to function: png_read_filter_row
KLEE: WARNING: undefined reference to function: pow
KLEE: WARNING: undefined reference to function: read
KLEE: WARNING: undefined reference to function: write
KLEE: WARNING: undefined reference to function: kill (UNSAFE)!
KLEE: WARNING ONCE: calling external: ioctl(0, 21505, 72201376)
KLEE: WARNING ONCE: calling __user_main with extra arguments.
KLEE: WARNING ONCE: calling external: open(71722064, 0, 438)
KLEE: WARNING ONCE: calling external: _setjmp(72412608)
KLEE: WARNING ONCE: calling external: read(8, 72474196, 8)
KLEE: WARNING ONCE: calling external: write(1, 71715312, 26)
png_write_info_before_PLTE
klee
klee1
KLEE: WARNING ONCE: flushing 65536 bytes on read, may be slow and/or crash: MO376148[65536] allocated at png_malloc_default():  %6 = call noalias i8* @malloc(i64 %5) nounwind, !dbg !11449

段错误 (核心已转储)


